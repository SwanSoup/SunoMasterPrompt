<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Suno Creator">
  <meta name="mobile-web-app-capable" content="yes">
  <title>Suno Prompt Creator Pro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: white;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
      padding-top: 30px;
    }

    .header h1 {
      font-size: 3rem;
      margin-bottom: 15px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .header p {
      font-size: 1.2rem;
      opacity: 0.95;
    }

    .card {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 25px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 900px) {
      .two-column {
        grid-template-columns: 1fr;
      }
    }

    label {
      display: block;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    textarea {
      width: 100%;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      font-size: 1rem;
      resize: vertical;
      min-height: 120px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
    }

    textarea:focus {
      outline: none;
      border-color: #fff;
    }

    button {
      padding: 15px 25px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 15px;
    }

    .btn-generate {
      width: 100%;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .btn-generate:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
    }

    .btn-refine {
      width: 100%;
      background: linear-gradient(135deg, #ffd89b 0%, #ff6a00 100%);
      color: white;
    }

    .btn-refine:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 106, 0, 0.4);
    }

    .btn-generate:disabled, .btn-refine:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .btn-copy {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 8px 15px;
      width: auto;
      display: inline-block;
      margin-top: 0;
      font-size: 0.9rem;
    }

    .btn-copy:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .btn-download {
      background: linear-gradient(135deg, #13f1fc 0%, #0470dc 100%);
      color: white;
      width: 100%;
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(4, 112, 220, 0.4);
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .result-header h2 {
      font-size: 1.5rem;
    }

    .result-header h3 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: #ffd89b;
    }

    .result-content {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      line-height: 1.6;
      font-size: 0.95rem;
    }

    .error {
      background: rgba(255, 59, 48, 0.2);
      border: 2px solid rgba(255, 59, 48, 0.5);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .instructions {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .instructions h3 {
      font-size: 1.3rem;
      margin-bottom: 15px;
    }

    .instructions ol {
      padding-left: 20px;
    }

    .instructions li {
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .badge {
      display: inline-block;
      background: rgba(255, 215, 0, 0.2);
      border: 1px solid rgba(255, 215, 0, 0.5);
      color: #ffd700;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
    }

    .hidden {
      display: none;
    }

    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .refine-section {
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid rgba(255, 215, 0, 0.3);
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
    }

    .refine-section label {
      color: #ffd700;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéµ Suno Prompt Creator Pro</h1>
      <p>Powered by Claude AI - Create & Refine Perfect Suno v5 Prompts</p>
      <button onclick="downloadApp()" style="margin-top: 15px; background: rgba(255,255,255,0.2); border: 2px solid rgba(255,255,255,0.4); color: white; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 0.9rem; font-weight: 600;">
        üì± Download as App (Add to Home Screen)
      </button>
    </div>

    <div class="card">
      <div style="margin-bottom: 20px;">
        <label style="margin-bottom: 15px;">Creation Mode:</label>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
            <input type="radio" name="mode" value="full" checked onchange="toggleMode()" style="margin-right: 8px; cursor: pointer;">
            <span>Full Generation (Prompts + Lyrics)</span>
          </label>
          <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
            <input type="radio" name="mode" value="lyrics-only" onchange="toggleMode()" style="margin-right: 8px; cursor: pointer;">
            <span>I Have Lyrics (Generate Prompts Only)</span>
          </label>
        </div>
      </div>

      <div id="fullModeSection">
        <label for="userRequest">What kind of song do you want to create?</label>
        <textarea 
          id="userRequest" 
          placeholder="Example: A melancholic indie folk song about missing home, with acoustic guitar and gentle harmonies, 85 BPM..."
        ></textarea>
      </div>

      <div id="lyricsOnlySection" class="hidden">
        <label for="existingLyrics">Paste Your Lyrics Here:</label>
        <textarea 
          id="existingLyrics" 
          placeholder="Paste your complete song lyrics here...&#10;&#10;[Verse 1]&#10;Your lyrics...&#10;&#10;[Chorus]&#10;Your lyrics..."
          style="min-height: 200px;"
        ></textarea>
        <label for="lyricDescription" style="margin-top: 15px;">Describe the desired sound/style:</label>
        <textarea 
          id="lyricDescription" 
          placeholder="Example: Dark trap-soul hybrid, 80 BPM, moody female vocals with heavy 808s, melancholic and atmospheric..."
          style="min-height: 100px;"
        ></textarea>
      </div>

      <button class="btn-generate" onclick="generateContent()">
        ‚ú® <span id="generateButtonText">Generate Suno Content</span>
      </button>
    </div>

    <div id="error" class="error hidden"></div>

    <div id="refineSection" class="card refine-section hidden">
      <label for="refinementRequest">üé® Refine Your Prompts <span class="badge">NEW</span></label>
      <p style="margin-bottom: 15px; opacity: 0.9; font-size: 0.95rem;">
        Describe what needs to change (e.g., "make it darker and slower", "lyrics should be more hopeful", "add more electronic elements")
      </p>
      <textarea 
        id="refinementRequest" 
        placeholder="Example: The output was too upbeat. Make it more melancholic and slow down the tempo. The lyrics should feel more nostalgic and bittersweet..."
        style="min-height: 100px;"
      ></textarea>
      <button class="btn-refine" onclick="refineContent()">
        üîÑ Refine Prompts
      </button>
    </div>

    <div id="results" class="hidden">
      <div class="two-column">
        <div class="card">
          <div class="result-header">
            <div>
              <h2>Style Prompt: Narrative</h2>
              <span class="badge">TYPE 1</span>
            </div>
            <button class="btn-copy" onclick="copyToClipboard('narrativePrompt')">üìã Copy</button>
          </div>
          <div class="result-content" id="narrativePromptContent"></div>
          <p style="margin-top: 10px; font-size: 0.85rem; opacity: 0.7;">
            ‚ÑπÔ∏è Flowing, story-driven description - great for emotional journeys
          </p>
        </div>

        <div class="card">
          <div class="result-header">
            <div>
              <h2>Style Prompt: Structured</h2>
              <span class="badge">TYPE 2</span>
            </div>
            <button class="btn-copy" onclick="copyToClipboard('structuredPrompt')">üìã Copy</button>
          </div>
          <div class="result-content" id="structuredPromptContent"></div>
          <p style="margin-top: 10px; font-size: 0.85rem; opacity: 0.7;">
            ‚ÑπÔ∏è Technical, element-by-element breakdown - great for precise control
          </p>
        </div>
      </div>

      <div class="card">
        <div class="result-header">
          <h2>Song Title</h2>
          <button class="btn-copy" onclick="copyToClipboard('title')">üìã Copy</button>
        </div>
        <div class="result-content" id="titleContent"></div>
      </div>

      <div class="card">
        <div class="result-header">
          <h2>Lyrics with Meta-Tags</h2>
          <button class="btn-copy" onclick="copyToClipboard('lyrics')">üìã Copy</button>
        </div>
        <div class="result-content" id="lyricsContent"></div>
      </div>

      <button class="btn-download" onclick="downloadAll()">
        ‚¨áÔ∏è Download All as Text File
      </button>
    </div>

    <div id="instructions" class="instructions">
      <h3>How to Use (Optimized for Suno v5):</h3>
      
      <p style="margin-bottom: 15px; font-weight: 600;">üìù Full Generation Mode:</p>
      <ol style="margin-bottom: 20px;">
        <li>Describe your song idea (genre, mood, theme, tempo, instruments, vocal style)</li>
        <li>Click "Generate Suno Content" - creates TWO style prompts plus complete lyrics</li>
        <li>Copy one style prompt and paste into Suno's "Song Description" field</li>
        <li>Copy the Lyrics (with meta-tags) and paste into Suno's "Lyrics" field</li>
        <li>Generate in Suno and listen to the result</li>
        <li><strong>NEW:</strong> Use "Refine" to adjust if needed!</li>
      </ol>

      <p style="margin-bottom: 15px; font-weight: 600;">üé§ I Have Lyrics Mode:</p>
      <ol>
        <li>Switch to "I Have Lyrics" mode</li>
        <li>Paste your existing lyrics</li>
        <li>Describe the sound/style you want</li>
        <li>Get optimized style prompts + meta-tags added to your lyrics</li>
        <li>Your lyrics stay exactly the same - just enhanced with proper tags!</li>
      </ol>

      <p style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
        ‚ú® Features: Dual prompt styles (narrative + structured), iterative refinement, bring-your-own-lyrics support, proven Suno v5 techniques
      </p>
    </div>
  </div>

  <script>
    let currentResult = null;
    let conversationHistory = [];
    let currentMode = 'full';

    function toggleMode() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      currentMode = mode;
      
      const fullSection = document.getElementById('fullModeSection');
      const lyricsOnlySection = document.getElementById('lyricsOnlySection');
      const generateButtonText = document.getElementById('generateButtonText');
      
      if (mode === 'full') {
        fullSection.classList.remove('hidden');
        lyricsOnlySection.classList.add('hidden');
        generateButtonText.textContent = 'Generate Suno Content';
      } else {
        fullSection.classList.add('hidden');
        lyricsOnlySection.classList.remove('hidden');
        generateButtonText.textContent = 'Generate Style Prompts & Tags';
      }
    }

    async function generateContent() {
      const errorDiv = document.getElementById('error');
      const resultsDiv = document.getElementById('results');
      const instructionsDiv = document.getElementById('instructions');
      const refineSection = document.getElementById('refineSection');
      const generateBtn = document.querySelector('.btn-generate');

      let userRequest, existingLyrics, lyricDescription;

      if (currentMode === 'full') {
        userRequest = document.getElementById('userRequest').value.trim();
        if (!userRequest) {
          showError('Please enter a song idea or request');
          return;
        }
      } else {
        existingLyrics = document.getElementById('existingLyrics').value.trim();
        lyricDescription = document.getElementById('lyricDescription').value.trim();
        
        if (!existingLyrics) {
          showError('Please paste your lyrics');
          return;
        }
        if (!lyricDescription) {
          showError('Please describe the desired sound/style');
          return;
        }
      }

      // Hide previous results and errors
      errorDiv.classList.add('hidden');
      resultsDiv.classList.add('hidden');
      refineSection.classList.add('hidden');
      
      // Disable button and show loading
      generateBtn.disabled = true;
      generateBtn.innerHTML = '<span class="spinner"></span>Generating...';

      // Reset conversation history for new generation
      conversationHistory = [];

      try {
        let systemPrompt;

        if (currentMode === 'full') {
          systemPrompt = `You are an expert at creating Suno v5 prompts following best practices. Generate optimized content for Suno v5.

SUNO V5 BEST PRACTICES:

TWO STYLE PROMPT FORMATS (both max 1000 chars):

FORMAT 1 - NARRATIVE/FLOWING:
A (genre/style) track about (core emotion/theme), opening with (intro instruments + ambiance) that sets a (mood descriptor) tone. Verses feature (vocal style and lyrical focus), supported by (background layers or textures). The chorus bursts in with (instrumental shift + emotion), evoking a sense of (feeling or visual metaphor). The bridge introduces (instrument or dynamic change), offering contrast before rising into a climactic final chorus filled with (production effects, harmonies, or instrumentation). Feels like (cinematic metaphor or scene)‚Äîemotional, layered, and immersive.

FORMAT 2 - STRUCTURED/TECHNICAL:
Genre: [Full paragraph on genre fusion, production approach, era, influences, tone, technical clarity]
Style: [Groove, rhythmic shifts, emotional tension. Wrap mood naturally]
Tempo: [Specific BPM or tempo descriptor]
Key: [e.g., "E major (bright and uplifting)"]
Singer's Voice: [Flowing description of vocal character‚Äîtone, delivery, inflection, grit/smoothness, emotional nuance]
Instrumentation: [Rich sentence listing instruments with roles, textures, interactions, layers, genre-specific adjectives]
Mastering: [How the mix feels‚Äîstereo field, dynamic range, warmth/saturation, analog/digital balance. Vivid and punchy]

LYRICS PROMPT (max 5000 chars):
- Start with bracketed meta-tags: [Genre: X] [Tempo: X BPM] [Mood: X] [Vocalist: X] [Instrument: X]
- Use section tags: [Intro], [Verse], [Chorus], [Bridge], [Drop], [Outro]
- Parentheses () for background vocals/ad-libs: (echoed whisper: "text")
- Square brackets [] for mid-song cues: [guitar solo], [drums drop out]
- Asterisks ** for sound effects (sparingly): *thunder*
- Inline tags: [Energy: High], [Mood: Intimate]

User Request: "${userRequest}"

CRITICAL: Respond ONLY with valid JSON. NO backticks or markdown:

{
  "narrativePrompt": "flowing story-driven style prompt format 1",
  "structuredPrompt": "technical element-by-element style prompt format 2",
  "title": "song title",
  "lyrics": "meta-tags then structured lyrics with [section] markers"
}

DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;
        } else {
          // Lyrics-only mode
          systemPrompt = `You are an expert at creating Suno v5 style prompts and adding proper meta-tags to existing lyrics.

The user has provided their own lyrics. Your job is to:
1. Analyze the lyrics to understand the theme, emotion, and structure
2. Generate TWO optimized style prompts based on the user's description
3. Add proper Suno v5 meta-tags to the beginning of the lyrics (but keep the lyrics exactly as provided)
4. Extract or create an appropriate title

EXISTING LYRICS:
${existingLyrics}

DESIRED SOUND/STYLE:
${lyricDescription}

TWO STYLE PROMPT FORMATS (both max 1000 chars):

FORMAT 1 - NARRATIVE/FLOWING:
A (genre/style) track about (core emotion/theme), opening with (intro instruments + ambiance) that sets a (mood descriptor) tone. Verses feature (vocal style and lyrical focus), supported by (background layers or textures). The chorus bursts in with (instrumental shift + emotion), evoking a sense of (feeling or visual metaphor). The bridge introduces (instrument or dynamic change), offering contrast before rising into a climactic final chorus filled with (production effects, harmonies, or instrumentation). Feels like (cinematic metaphor or scene)‚Äîemotional, layered, and immersive.

FORMAT 2 - STRUCTURED/TECHNICAL:
Genre: [Full paragraph on genre fusion, production approach, era, influences, tone, technical clarity]
Style: [Groove, rhythmic shifts, emotional tension. Wrap mood naturally]
Tempo: [Specific BPM or tempo descriptor]
Key: [e.g., "E major (bright and uplifting)"]
Singer's Voice: [Flowing description of vocal character‚Äîtone, delivery, inflection, grit/smoothness, emotional nuance]
Instrumentation: [Rich sentence listing instruments with roles, textures, interactions, layers, genre-specific adjectives]
Mastering: [How the mix feels‚Äîstereo field, dynamic range, warmth/saturation, analog/digital balance. Vivid and punchy]

META-TAGS TO ADD (before the lyrics):
[Genre: X] [Tempo: X BPM] [Mood: X] [Vocalist: X] [Instrument: X] [Instrument: Y]

CRITICAL: Respond ONLY with valid JSON. NO backticks or markdown:

{
  "narrativePrompt": "flowing story-driven style prompt based on their lyrics and description",
  "structuredPrompt": "technical element-by-element style prompt based on their lyrics and description",
  "title": "extracted or created song title",
  "lyrics": "meta-tags at the top, then their EXACT lyrics unchanged (preserve all formatting, line breaks, and section markers)"
}

DO NOT OUTPUT ANYTHING OTHER THAN VALID JSON.`;
        }

        conversationHistory.push({
          role: "user",
          content: systemPrompt
        });

        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 3000,
            messages: conversationHistory
          })
        });

        if (!response.ok) {
          throw new Error(`API request failed: ${response.status}`);
        }

        const data = await response.json();
        let responseText = data.content[0].text;
        
        // Add assistant response to history
        conversationHistory.push({
          role: "assistant",
          content: responseText
        });
        
        // Strip markdown formatting if present
        responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
        
        currentResult = JSON.parse(responseText);
        
        // Display results
        displayResults();
        
        resultsDiv.classList.remove('hidden');
        refineSection.classList.remove('hidden');
        instructionsDiv.classList.add('hidden');
        
      } catch (err) {
        console.error("Error:", err);
        showError(`Failed to generate content: ${err.message}`);
      } finally {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '‚ú® <span id="generateButtonText">' + 
          (currentMode === 'full' ? 'Generate Suno Content' : 'Generate Style Prompts & Tags') + 
          '</span>';
      }
    }

    async function refineContent() {
      const refinementRequest = document.getElementById('refinementRequest').value.trim();
      const errorDiv = document.getElementById('error');
      const refineBtn = document.querySelector('.btn-refine');

      if (!refinementRequest) {
        showError('Please describe what you want to change');
        return;
      }

      if (conversationHistory.length === 0) {
        showError('Please generate content first before refining');
        return;
      }

      errorDiv.classList.add('hidden');
      refineBtn.disabled = true;
      refineBtn.innerHTML = '<span class="spinner"></span>Refining...';

      try {
        const refinePrompt = `Based on the previous generation, please refine the prompts with these changes: ${refinementRequest}

Keep the same JSON structure. Make the requested adjustments while maintaining Suno v5 best practices.

CRITICAL: Respond ONLY with valid JSON. NO backticks or markdown:

{
  "narrativePrompt": "refined narrative prompt",
  "structuredPrompt": "refined structured prompt",
  "title": "refined or same title",
  "lyrics": "refined lyrics with adjustments"
}`;

        conversationHistory.push({
          role: "user",
          content: refinePrompt
        });

        const response = await fetch("https://api.anthropic.com/v1/messages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            model: "claude-sonnet-4-20250514",
            max_tokens: 3000,
            messages: conversationHistory
          })
        });

        if (!response.ok) {
          throw new Error(`API request failed: ${response.status}`);
        }

        const data = await response.json();
        let responseText = data.content[0].text;
        
        // Add assistant response to history
        conversationHistory.push({
          role: "assistant",
          content: responseText
        });
        
        responseText = responseText.replace(/```json\n?/g, "").replace(/```\n?/g, "").trim();
        
        currentResult = JSON.parse(responseText);
        
        displayResults();
        
        // Clear refinement textarea
        document.getElementById('refinementRequest').value = '';
        
        showNotification('Prompts refined successfully!');
        
      } catch (err) {
        console.error("Error:", err);
        showError(`Failed to refine content: ${err.message}`);
      } finally {
        refineBtn.disabled = false;
        refineBtn.innerHTML = 'üîÑ Refine Prompts';
      }
    }

    function displayResults() {
      document.getElementById('narrativePromptContent').textContent = currentResult.narrativePrompt;
      document.getElementById('structuredPromptContent').textContent = currentResult.structuredPrompt;
      document.getElementById('titleContent').textContent = currentResult.title;
      document.getElementById('lyricsContent').textContent = currentResult.lyrics;
    }

    function showError(message) {
      const errorDiv = document.getElementById('error');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
    }

    function copyToClipboard(type) {
      let text = '';
      
      switch(type) {
        case 'narrativePrompt':
          text = currentResult.narrativePrompt;
          break;
        case 'structuredPrompt':
          text = currentResult.structuredPrompt;
          break;
        case 'title':
          text = currentResult.title;
          break;
        case 'lyrics':
          text = currentResult.lyrics;
          break;
      }
      
      navigator.clipboard.writeText(text).then(() => {
        const labels = {
          narrativePrompt: 'Narrative Prompt',
          structuredPrompt: 'Structured Prompt',
          title: 'Title',
          lyrics: 'Lyrics'
        };
        showNotification(`${labels[type]} copied!`);
      });
    }

    function downloadAll() {
      if (!currentResult) return;
      
      const content = `STYLE PROMPT (NARRATIVE):\n${currentResult.narrativePrompt}\n\n${'='.repeat(80)}\n\nSTYLE PROMPT (STRUCTURED):\n${currentResult.structuredPrompt}\n\n${'='.repeat(80)}\n\nTITLE:\n${currentResult.title}\n\n${'='.repeat(80)}\n\nLYRICS:\n${currentResult.lyrics}`;
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${currentResult.title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_suno_prompts.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('File downloaded!');
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 2000);
    }

    // Allow Enter key to submit (with Shift+Enter for new lines)
    document.getElementById('userRequest').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        generateContent();
      }
    });

    document.getElementById('refinementRequest').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        refineContent();
      }
    });

    function downloadApp() {
      // Create a blob with the entire current HTML page
      const htmlContent = document.documentElement.outerHTML;
      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'suno-prompt-creator-pro.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('App downloaded! See instructions below.');
      
      // Show installation instructions
      setTimeout(() => {
        alert(`üì± HOW TO ADD TO HOME SCREEN:\n\niPhone/iPad:\n1. Open the downloaded HTML file in Safari\n2. Tap the Share button (square with arrow)\n3. Scroll down and tap "Add to Home Screen"\n4. Tap "Add" in the top right\n\nAndroid/Chrome:\n1. Open the downloaded HTML file in Chrome\n2. Tap the menu (three dots)\n3. Tap "Add to Home screen"\n4. Tap "Add"\n\nDesktop Chrome:\n1. Open the file in Chrome\n2. Click the install icon in the address bar\n   OR\n3. Menu ‚Üí "Install Suno Prompt Creator Pro"\n\nThe app works 100% offline once installed!`);
      }, 500);
    }
  </script>
</body>
</html>
